# 计算机网络

---

## 第一章 计算机网络和因特网

**计算机网络（Computer Networking）**是指将[地理](https://baike.baidu.com/item/地理)位置不同的具有独立功能的多台[计算机](https://baike.baidu.com/item/计算机/140338)及其外部设备，通过通信线路连接起来，在[网络操作系统](https://baike.baidu.com/item/网络操作系统/3997)，[网络管理软件](https://baike.baidu.com/item/网络管理软件/6579078)及[网络通信协议](https://baike.baidu.com/item/网络通信协议/4438611)的管理和协调下，实现[资源共享](https://baike.baidu.com/item/资源共享/233480)和信息传递的**计算机系统**。

### 因特网

**因特网（Internet）**是一个世界范围内的计算机网络，互联了全世界的电子设备，包括计算机、个人终端、非传统因特网物品。

#### 具体构成

这些设备被称为**主机（host）**或**端系统（end system）**。端系统通过**通信链路（communication link）**和**分组交换机（packet switch）** **连接** 在一起。

通信链路的**传输速率（transmission rate）**以比特秒（bit/s，或bps）度量。当一台端系统向另一台端系统发送信息时，会将数据分段成多个信息包，称为**分组（packet）**。

常见的分组交换机是**路由器（router）**和**链路层交换机（link-layer switch）**，两者的作用是向目的地转发分组。路由器通常用于网络核心中，链路层交换机通常用于接入网络。一个分组经过的通信链路和分组交换机被称为**路径（route）**。以交通运输系统类比分组交换网络：

+ 分组：货物
+ 端系统：目的地
+ 通信链路：高速公路
+ 分组交换机：交叉路口和引导牌

端系统通过**因特网服务提供商（Internet Service Provider，ISP）** **接入互联网**，每个 ISP 自身就是一个由多台分组交换机和多段通信链路组成的网络。ISP 之间也分等级，并需要互联，以此接入全球互联网。

端系统、分组交换机和其他因特网部件需要运行一系列**协议（protocol）**，控制因特网信息的接收和发送。**TCP（Transmission Control Protocol，传输控制协议）**和 **IP（Internet Protocol，因特网协议）**是最重要的因特网协议。IP 定义了路由器和端系统之间发送和接收的分组的**格式**。主要协议统称 **TCP/IP** 协议。

**因特网标准（Internet Standard）**由因特网工程任务组（Internet Engineering Task Force，IETF）研发，他们的标准文档称为**请求评论（Request For Comment，RFC）**。

#### 服务

从 *为应用程序提供服务的基础设施* 的角度描述因特网，各种端系统被称为**分布式应用程序（distributed application）**。这些程序运行在各个端系统而不是网络核心的分组交换机中。这些应用程序使用特定语言编写，并互相发送数据，而因特网则是提供数据传输服务的平台。

连接因特网的端系统提供了一个**套接字接口（socket interface）**，规定了各端之间**交换数据的方式**。

#### 协议

**协议（protocol）**各方协商后制定的一套标准，人类语言日常交流的用语规范就是一套“提问与回答”的协议标准。**网络协议**类似于人类协议，区别在于通信双方是端系统。

计算机网络协议简称协议，定义了两个或多个通信实体之间交换的**报文**的格式和顺序，以及报文发送或接受一条报文或其他事件时采取的**动作**。如：向 Web 服务器请求网页，发送一条 GET （动作）请求，包含 HTTP 请求报文（报文），Web 服务器返回一个 HTML 文件（响应）。

### 网络边缘

一些因特网部件位于因特网的边缘，，因此它们被称为端系统。端系统也被称为 host（主机），因为它们容纳和运行一些应用程序，如 Web 浏览器与服务器。主机又可以分为**客户端（client）**与**服务器（server）**两类，如今一些提供数字媒体服务的服务器属于大型**数据中心（data center）**。

#### 接入网络

**接入网络**是将端系统物理连接到其**边缘路由器（edge router）**的网络，而边缘路由器是端系统连接到其他端系统时经过的**第一台**路由器。以下是常见的接入网场景：

+ 传统的家庭接入：DSL（用户数据线，利用现有的电话线路设施）、电缆接入（利用现有的有线电视设施）、FTTH（光纤到户，分为有源和无源）、拨号（和DSL模式相同）、卫星接入
+ 企业和现代家庭接入：以太网（Ethernet，由 Xerox 公司发明，现有 IEEE 802.3标准）、Wi-Fi（无线通信技术）
+ 广域无线接入：3G、4G、5G 以及其他蜂窝网络技术

现在家庭接入网络通常包括：

+ 外部接入物理媒体
  + 双绞铜线：是一种通过双绞构造增强干扰性、在百米内有效的媒体，一般用于局域网（LAN），可能需要与放大器一起工作
  + 同轴电缆：类似双绞铜线的媒体，拥有更强的抗干扰能力和更远的可靠传输距离，是过去主要的因特网接入手段
  + 光纤：是目前速度最快、传输距离最长、安全性最高的媒体，需要使用特殊的调制解调器（光猫）
+ **调制解调器（modem）**：也称“猫”，用于将媒体中传输的模拟信号转为计算机硬件可识别的数字信号。对于光纤，需要使用数字调制解调器将光信号转换为数字信号
+ **防火墙（firewall）**：用于在外网和内网之间构建一道安全屏障，保护用户资料和信息安全
+ **路由器（router）**：家庭用交换机一般为路由器，起到网关的作用。路由器处理分组，将非 TCP/IP 地址转为 TCP/IP 地址并发送分组。由于家用宽带入线通常只有一根，路由器起到建立家庭局域网的作用，多台家用设备通过路由器向外转发分组，由路由器根据转发表确认这些分组去向。在接到响应分组时，根据分组首部信息，确定分组内网中去向，转发给指定设备。目前光纤到户技术已经普及，一些路由器已经内置调制解调器功能，可以直接和光线连接并进行转发
+ **局域网（LAN）**：局域网一般是覆盖范围比较小的计算机网络。**以太网（Ethernet）**是家庭局域网技术的一种，是最普遍的局域网络。现代路由器将局域网建立功能内置，通过有线或无线媒体的方式连接家用局域网中的设备
+ **无线局域网（WLAN）**：利用无线通信技术（Wi-Fi）可以建立通过无线媒体连接设备的局域网
+ 家用设备：常见的家用联网设备有个人计算机、移动终端、智能家具、网络摄像头等

#### 物理媒体

数字比特需要通过**物理媒体（physical media）**传输。物理媒体分为两种类型：

+ 导引型媒体：guided media，沿固体媒体前行，如光纤
+ 非导引型媒体：unguided media，以电磁波形式在空气或外层空间传播，如无线电

### 网络核心

**网络的核心部分**是由分组交换机和通信链路构成的网状网络。数据传输的方式有**分组交换**和**电路交换**。现代的因特网是**网络的网络**。

#### 分组交换

在网络应用中，端系统彼此交换**报文（message）**。报文用于执行控制功能（如 Restful 状态转移），也可以包含数据（如 HTTP 传输超媒体）。发送源将长报文划分为较小的数据块，称为**分组（packet）**，这些分组通过通信链路和**分组交换机**（**packet switch**，本意是转换光电信号的“开关”，主要为**路由器（router）**和**链路层交换机（link-layer switch）**）传输。

分组交换使用**最大传输速率**发送分组，如果一个大小为 L 比特的分组通过速率为 R 比特/秒的链路传输，那么传输时间就是 L/R 秒。

分组交换不会预留任何链路需要的资源，分组需要承受**排队延迟**，因特网不会保证分组实时交付。

##### 存储转发传输

多数分组交换机采用**存储转发传输（store-and-forward transmission）**机制。该机制在向传输链路输出第一个比特前，**必须接受到一个完整的分组**，在转发前接收到的比特会先被**缓存（即 store，存储）**。

与接收到比特就转发（流）的方式相比，假设链路速率为 R ，比特数为 L，转发接收延迟为 2L/R（接收 L/R + 转发 L/R），而流无需等待，为 L/R 。

##### 排队延迟和分组丢失

分组交换机会为每条有最大传输速率限制的通信链路准备**输出缓存（output buffer，也称输出队列（output queue））**。如果一个完整分组已到达，而链路忙于传输其他分组，该到达分组会被缓存等待，直到链路空闲。因此，除了分组交换机的转发过程延迟，分组还需承受输出缓存过程的**排队延迟（queuing delay）**。

由于缓存空间有限，当通信链路传输过慢时，会出现缓存空间不足的情况。此时如果有新分组到达，处于输出缓存中的某个分组或新到达的分组会被丢弃，即**分组丢失（或丢包，packet loss ，PL）**

##### 转发表和路由协议选择

在因特网中，每个端系统有一个 **IP 地址（Internet Protocol Address）**。每个分组的首部包含了传输目的地的 IP，IP 有一种等级结构，这个结构决定各级路由器如何转发分组。路由器会检查分组首部包含的 IP 信息，根据路由器内部的**转发表（forwarding table，用于将目的地地址（或地址一部分）映射到通信链路）**找到适合的输出链路。

这些转发表无需手动设置（静态路由），因特网具有一些特殊的**路由选择协议（routing protocol）**，用于自动设置转发表（动态路由）。

#### 电路交换

交换机移动数据的另一种方法是**电路交换（circuit switching）**。与分组交换按需分配模式不同，电路交换会预留端系统沿路径通信时需要的**资源**（缓存，链路传输速率）。在端系统向另一端系统发送消息前，两者会建立连接，路径上的交换机需要维护这些**连接状态**（用电话术语来讲即是**电路（circuit）**）。

##### 电路交换网络中的复用

电路交换网络中的**复用**是指每条链路会为多个连接使用。有两种复用方式：

+ **频分复用（Frequency-Division Multiplexing，FDM）**将一条链路的频谱按一定的频段宽度分开，该频段宽度被称为**带宽（band-width）**，多个连接在同时共用同一条链路
+ **时分复用（Time-Division Multiplexing，TDM）**在固定时间内将一条链路分为固定期间的**帧**，每个帧又被划分为固定数量的**时隙**。每个时隙有一个连接独享，多个连接在固定周期中排队使用链路

##### 与分组交换对比

分组交换因为没有预留资源，其端到端时延是可变与不可预测的，不适合实时通讯服务。但与电路交换相比，分组交换**动态按需分配资源**，更简单、有效、低成本，在**低并发**场景下有近似于电路交换的效率。此外，分组交换在链路空闲时，可为单个连接提供最大传输效率，而不是浪费空闲资源。目前来看，分组交换是现在的趋势。

> [Traceroute](https://www.traceroute.org) 提供一些源，并能进行端到端路由线路跟踪

#### 网络的网络

网络边缘上的端系统通过**接入 ISP** 与因特网连接，这只是整个互联网需要解决的问题的一小部分，接入 ISP 自身必须能够互联，这个问题通过创建**“网络的网络”**来解决。网络的网络是有层级的结构，不同层级的节点不仅与高层节点连接，还可能与同级甚至跨级连接，整个网络是**图状结构**而非树状结构。

目前因特网的网络结构是一种多层结构，由**接入 ISP**、**区域 ISP（regional ISP）**、**第一层 ISP（tier-1 ISP）**、**PoP（Point of Presence，存在点）**、**多宿（multi-home）**、**对等（peer）**、**因特网交换点（Internet Exchange Point，IXP）**和**内容提供商网络（content provider network，CPN）**组成。

+ 接入 ISP：将端系统连接到因特网的 ISP
+ 区域 ISP：在一些区域中有一些 ISP 连接这各个接入 ISP，这些 ISP 会与更大的区域 ISP 或第一层 ISP 连接
+ 第一层 ISP：在第一层 ISP 看来，与之连接的 ISP 是**客户**，而自己是**提供商**，第一层 ISP 是全球范围的 ISP，并不向任何人收取结算费用。全球范围内有多个第一层 ISP 存在并互联
+ PoP ：PoP 是一个 ISP 网络中的一台或多台路由器群组，通常位于同一位置。客户 ISP 或其 PoP 可以通过第三方提供的链路连接到提供商 ISP 的某个最近的 PoP
+ 多宿：一个客户 ISP 与多个提供商 ISP 连接的行为称为多宿，当其中一个提供商 ISP 故障时客户 ISP 依旧可以交换数据
+ 对等：位于同一层级结构且物理邻近的 ISP 可以直接连接，而不需要通过上一级 ISP 交换数据，称为对等。通常对等时 ISP 之间不结算费用
+ 因特网交换点：IXP 是一个汇合点，通常位于第三方提供有着自己独立交换机的建筑中，各级 ISP 及其 PoP 可能位于 IXP 中并对等
+ 内容提供商网络：内容提供商网络（如 Google）与第一层 ISP 同级。Google 的数据中心网络通过专用的 TCP/IP 通道连接，独立于公共因特网，与同级或较低层的 ISP 直接互联（在 IXP 处互联或直接连接），并不收取结算费用。内容提供商通过这种方式减少了向顶层提供商支付的费用，并加强了其对服务如何交付给客户的过程的控制权

